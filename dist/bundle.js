!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t,r,i){if(n(this,e),!(this instanceof e))return new e(tagName,r,i);if(this.tag=t,this.props=r||{},this.children=i||[],this.key=r?r.key:void 0,!this.key)throw new Error(t+" ... the key is undefined");var o=0;this.children.forEach(function(t){t instanceof e&&(o+=t.count),o++}),this.count=o}return i(e,[{key:"render",value:function(){var t=document.createElement(this.tag),r=this.props;for(var i in r)l.setAttr(t,i,r[i]);return this.children.forEach(function(r){var i=r instanceof e?r.render():document.createTextNode(r);t.appendChild(i)}),t}}]),e}(),s=function(){function e(t,r){n(this,e),this.index=0,this.patches={},this.dfsWalk(t,r,this.index)}return i(e,[{key:"dfsWalk",value:function(e,t,r){var i=[];if(null==t);else if(l.isString(e)&&l.isString(t))e!=t&&i.push({type:3,content:t});else if(e.tagName===t.tagName&&e.key==t.key){var n=this.diffProps(e,t);n&&i.push({type:2,props:n}),l.isIgnoreChildren(t)||this.diffChildren(e.children,t.children,r,i)}else i.push({type:0,node:t});i.length&&(this.patches[r]=i)}},{key:"diffProps",value:function(e,t){var r=e.props,i=t.props,n={},o=!0;for(var s in r)i[s]!==r[s]&&(o=!1,n[s]=i[s]);for(var a in i)r.hasOwnProperty(a)||(o=!1,n[a]=i[a]);return o?null:n}},{key:"diffChildren",value:function(e,t,r,i){var n=this,o=new u(e,t).getResult();if(t=o.child,o.moves.length){var s={type:1,moves:o.moves};i.push(s)}var a=null,l=r;e.forEach(function(e,r){var i=t[r];l=a&&a.count?l+a.count+1:l+1,n.dfsWalk(e,i,l),a=e})}}]),e}(),a=function(){function e(t,r){n(this,e);this.dfsWalk(t,{index:0},r)}return i(e,[{key:"dfsWalk",value:function(e,t,r){for(var i=r[t.index],n=e.childNodes?e.childNodes.length:0,o=0;o<n;o++){var s=e.childNodes[o];t.index++,this.dfsWalk(s,t,r)}i&&this.applyPatches(e,i)}},{key:"applyPatches",value:function(e,t){var r=this;t.forEach(function(t){switch(t.type){case 0:var i=l.isString(t.node)?document.createTextNode(t.node):t.node.render();e.parentNode.replaceChild(i,e);break;case 1:r.reorderChildren(e,t.moves);break;case 2:r.setProps(e,t.props);break;case 3:e.textContent?e.textContent=t.content:e.nodeValue=t.content}})}},{key:"reorderChildren",value:function(e,t){var r=l.toArray(e.childNodes),i={};r.forEach(function(e){if(1===e.nodeType){var t=e.getAttribute("key");t&&(i[t]=e)}}),t.forEach(function(t){var n=t.index;if(0===t.type)r[n]===e.childNodes[n]&&e.removeChild(e.childNodes[n]),r.splice(n,1);else if(1===t.type){var o=i[t.item.key]?i(t.item.key).cloneNode(!0):l.isString(t.item)?document.createTextNode(t.item):t.item.render();r.splice(n,0,o),e.insertBefore(o,e.childNodes[n]||null)}})}},{key:"setProps",value:function(e,t){for(var r in t)if(void 0===t[r])e.removeAttribute(r);else{var i=t[r];l.setAttr(e,r,i)}}}]),e}(),l=function(){function e(){n(this,e)}return i(e,null,[{key:"isString",value:function(e){return"string"==typeof e}},{key:"toArray",value:function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}},{key:"isForIn",value:function(e){return/^\w* _in_ \w*$/.test(e)}},{key:"isForForIn",value:function(e){return/^\w* _in*$/.test(e)}},{key:"isForOrForFor",value:function(e){return/^\w* _in_ \w|_in*$/.test(e)}},{key:"isIgnoreChildren",value:function(e){return e.props&&e.props.hasOwnProperty("ignore")}},{key:"setAttr",value:function(e,t,r){switch(t){case"style":e.style.cssText=r;break;case"value":var i=e.tagName||"";"input"===(i=i.toLowerCase())||"textarea"===i?e.value=r:e.setAttribute(t,r);break;default:e.setAttribute(t,r)}}}]),e}(),u=function(){function e(t,r){n(this,e);var i=this.makeKeyIndex(t).keyIndex,o=this.makeKeyIndex(r).keyIndex;this.moveOperator=[],this.childList=[];for(var s=0;s<t.length;s++){var a=t[s],l=this.getKey(a);o.hasOwnProperty(l)?this.childList.push(r[o[l]]):this.childList.push(null)}this.tempList=this.childList.slice(0);for(var u=0;u<this.tempList.length;)null===this.tempList[u]?(this.remove(u),this.removeCopyTempList(u)):u++;for(var h=0,c=0;c<r.length;c++){var p=r[c],f=this.getKey(p),d=this.tempList[h],v=this.getKey(d);if(d)if(f!=v)if(i.hasOwnProperty(f))f===getKey(this.tempList[h+1])?(this.remove(c),this.removeCopyTempList(h),h++):this.insert(c,p);else this.insert(c,p);else h++;else this.insert(c,p)}for(var y=this.tempList.length-h;h++<this.tempList.length;)y--,this.remove(y+r.length)}return i(e,[{key:"makeKeyIndex",value:function(e){for(var t={},r=0;r<e.length;r++){var i=e[r];t[this.getKey(i)]=r}return{keyIndex:t}}},{key:"getKey",value:function(e){if(e)return e.key}},{key:"removeCopyTempList",value:function(e){this.tempList.splice(e,1)}},{key:"remove",value:function(e){this.moveOperator.push({index:e,type:0})}},{key:"insert",value:function(e,t){this.moveOperator.push({index:e,item:t,type:1})}},{key:"getResult",value:function(){return{moves:this.moveOperator,child:this.childList}}}]),e}();function h(){this.updateFunctions=new Set}h.prototype.add=function(e){this.updateFunctions.add(e)},h.prototype.invoke=function(){this.updateFunctions.forEach(function(e){return e()})};var c=function(){function e(){n(this,e),this.length=0,this.map=new Object}return i(e,[{key:"put",value:function(e,t){e in this.map||this.length++,this.map[e]=t}},{key:"get",value:function(e){return e in this.map?this.map[e]:null}},{key:"remove",value:function(e){e in this.map&&(delete this.map[e],this.length--)}},{key:"size",value:function(){return this.length}},{key:"clear",value:function(){length=0,this.map=new Object}}]),e}(),p=function(){function e(t){var r=this;n(this,e);var i,o,s,a=t.el,u=t.data,p=t.dom,f=l.isString(a)?document.querySelector(a):a;this.data=u,this.ve=this.getVirtualElement(this.applyTruthfulData(p)),this.w=this.ve.render(),f.appendChild(this.w),this.observeMap=new c,i=this.data,o=this.observeMap,s=function(){r.updatedom(p)},Object.keys(i).forEach(function(e){var t=i[e],r=new h;o.put(e,r),Object.defineProperty(i,e,{get:function(){return r.add(s),t},set:function(e){var i=t!==e;t=e,i&&r.invoke()}})}),this.updatedom(p)}return i(e,[{key:"updatedom",value:function(e){var t,r,i,n=this.getVirtualElement(this.applyTruthfulData(e));window.nve=n,window.ve=this.ve,t=this.w,i=this.ve,r=new s(i,n).patches,new a(t,r),this.ve=n}},{key:"watch",value:function(e,t){this.observeMap.get(e).add(t)}},{key:"getVirtualElement",value:function(e){var t=this,r=[];for(var i in e.children){var n=e.children[i];if(n instanceof Array)n.forEach(function(e){var i=t.getVirtualElement(e);r.push(i)});else if(n instanceof Object){var s=this.getVirtualElement(n);r.push(s)}else r.push(n)}return function(e,t,r){return new o(e,t,r)}(e.tag,e.props,r)}},{key:"applyTruthfulData",value:function(t){var r=this;if("for"in t.props||"for_for"in t.props){var i=[],n=!1,o=void 0;if(t.props.for){if(l.isForOrForFor(t.props.for))if(t.forData){if(l.isForIn(t.props.for))throw new Error("plase use _in direction");i=t.forData,o=t.props.for.split(" _in")[0]}else{if(l.isForForIn(t.props.for))throw new Error("plase use _in_ direction");i=this.data[t.props.for.split(" _in_ ")[1]],o=t.props.for.split(" _in_ ")[0]}}else{if(!t.props.for_for)throw new Error("the for direction use error");if(l.isForOrForFor(t.props.for_for)){if(l.isForForIn(t.props.for_for))throw new Error("plase use _in_ direction");n=!0,i=this.data[t.props.for_for.split(" _in_ ")[1]],o=t.props.for_for.split(" _in_ ")[0]}}var s=[];return i.forEach(function(i){var a={};for(var u in a.tag=t.tag,a.children=[],a.props={},t.children)l.isString(t.children[u])?e.isPlaceHolder(t.children[u])?-1==e.getPlaceHolderValue(t.children[u]).indexOf(o)?a.children[u]=r.data[e.getPlaceHolderValue(t.children[u])]:a.children[u]=i[e.getPlaceHolderValue(t.children[u]).split(".")[1]]:a.children[u]=t.children[u]:(n&&(t.children[u].forData=i),a.children[u]=r.applyTruthfulData(t.children[u]));var h=Object.keys(t.props);for(var c in h){var p=h[c];if("style"===p){var f=t.props[p];if(f.indexOf(",")>-1){var d=f.split(",");a.props[p]=r.handleArrayStyle(i,d,o)}else a.props[p]=r.handleSingleStyle(i,f,o)}else e.isPlaceHolder(t.props[p])?-1==e.getPlaceHolderValue(t.props[p]).indexOf(o)?a.props[p]=r.data[e.getPlaceHolderValue(t.props[p])]:a.props[p]=i[e.getPlaceHolderValue(t.props[p]).split(".")[1]]:a.props[p]=t.props[p]}s.push(a)}),s}var a={};for(var u in a.tag=t.tag,a.children=[],a.props={},t.children)l.isString(t.children[u])?e.isPlaceHolder(t.children[u])?a.children[u]=this.data[e.getPlaceHolderValue(t.children[u])]:a.children[u]=t.children[u]:a.children[u]=this.applyTruthfulData(t.children[u]);var h=Object.keys(t.props);for(var c in h){var p=h[c];if("style"===p){var f=t.props[p];if(f.indexOf(",")>-1){var d=f.split(",");a.props[p]=this.handleArrayStyle(this.data,d,void 0)}else a.props[p]=this.handleSingleStyle(this.data,f,void 0)}else e.isPlaceHolder(t.props[p])?a.props[p]=this.data[e.getPlaceHolderValue(t.props[p])]:a.props[p]=t.props[p]}return a}},{key:"handleSingleStyle",value:function(t,r,i){var n="";if(i)if(e.isPlaceHolder(r))if(-1!=e.getPlaceHolderValue(r).indexOf(i)){n=t[e.getPlaceHolderValue(r).split(".")[1]]}else{var o=r.split(":")[0],s=r.split(":")[1];n=o+":"+(s=t[e.getPlaceHolderValue(s)])}else n=r;else{var a=r.split(":")[0],l=r.split(":")[1];n=e.isPlaceHolder(l)?a+":"+(l=t[e.getPlaceHolderValue(l)]):r}return n}},{key:"handleArrayStyle",value:function(e,t,r){var i="",n=!0,o=!1,s=void 0;try{for(var a,l=t[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var u=a.value;i+=this.handleSingleStyle(e,u,r)+";"}}catch(e){o=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw s}}return i}}],[{key:"isPlaceHolder",value:function(e){return!!e&&!(!e.startsWith("%#")||!e.endsWith("#%"))}},{key:"getPlaceHolderValue",value:function(e){return e.slice(2,-2)}}]),e}();t.default=p}]);