!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var NODE_REPLACE=0,CHILD_RE_ORDER=1,NODE_PROPS=2,NODE_CONTENT=3,Element=function(){function e(t,r,i){if(_classCallCheck(this,e),!(this instanceof e))return new e(tagName,r,i);if(this.tag=t,this.props=r||{},this.children=i||[],this.key=r?r.key:void 0,!this.key)throw new Error(t+" ... html tag the key is undefined");var n=0;this.children.forEach(function(t){t instanceof e&&(n+=t.count),n++}),this.count=n}return _createClass(e,[{key:"render",value:function(){var t=document.createElement(this.tag),r=this.props;for(var i in r)Util.setAttr(t,i,r[i]);return this.children.forEach(function(r){var i=r instanceof e?r.render():document.createTextNode(r);t.appendChild(i)}),t}}]),e}(),Diff=function(){function e(t,r){_classCallCheck(this,e),this.index=0,this.patches={},this.dfsWalk(t,r,this.index)}return _createClass(e,[{key:"dfsWalk",value:function(e,t,r){var i=[];if(null==t);else if(Util.isString(e)&&Util.isString(t))e!=t&&i.push({type:NODE_CONTENT,content:t});else if(e.tagName===t.tagName&&e.key==t.key){var n=this.diffProps(e,t);n&&i.push({type:NODE_PROPS,props:n}),Util.isIgnoreChildren(t)||this.diffChildren(e.children,t.children,r,i)}else i.push({type:NODE_REPLACE,node:t});i.length&&(this.patches[r]=i)}},{key:"diffProps",value:function(e,t){var r=e.props,i=t.props,n={},a=!0;for(var l in r)i[l]!==r[l]&&(a=!1,n[l]=i[l]);for(var s in i)r.hasOwnProperty(s)||(a=!1,n[s]=i[s]);return a?null:n}},{key:"diffChildren",value:function(e,t,r,i){var n=this,a=new DiffList(e,t).getResult();if(t=a.child,a.moves.length){var l={type:CHILD_RE_ORDER,moves:a.moves};i.push(l)}var s=null,o=r;e.forEach(function(e,r){var i=t[r];o=s&&s.count?o+s.count+1:o+1,n.dfsWalk(e,i,o),s=e})}}]),e}(),Patch=function(){function e(t,r){_classCallCheck(this,e);this.dfsWalk(t,{index:0},r)}return _createClass(e,[{key:"dfsWalk",value:function(e,t,r){for(var i=r[t.index],n=e.childNodes?e.childNodes.length:0,a=0;a<n;a++){var l=e.childNodes[a];t.index++,this.dfsWalk(l,t,r)}i&&this.applyPatches(e,i)}},{key:"applyPatches",value:function(e,t){var r=this;t.forEach(function(t){switch(t.type){case NODE_REPLACE:var i=Util.isString(t.node)?document.createTextNode(t.node):t.node.render();e.parentNode.replaceChild(i,e);break;case CHILD_RE_ORDER:r.reorderChildren(e,t.moves);break;case NODE_PROPS:r.setProps(e,t.props);break;case NODE_CONTENT:e.textContent?e.textContent=t.content:e.nodeValue=t.content}})}},{key:"reorderChildren",value:function(e,t){var r=Util.toArray(e.childNodes),i={};r.forEach(function(e){if(1===e.nodeType){var t=e.getAttribute("key");t&&(i[t]=e)}}),t.forEach(function(t){var n=t.index;if(0===t.type)r[n]===e.childNodes[n]&&e.removeChild(e.childNodes[n]),r.splice(n,1);else if(1===t.type){var a=i[t.item.key]?i(t.item.key).cloneNode(!0):Util.isString(t.item)?document.createTextNode(t.item):t.item.render();r.splice(n,0,a),e.insertBefore(a,e.childNodes[n]||null)}})}},{key:"setProps",value:function(e,t){for(var r in t)if(void 0===t[r])e.removeAttribute(r);else{var i=t[r];Util.setAttr(e,r,i)}}}]),e}(),Util=function(){function Util(){_classCallCheck(this,Util)}return _createClass(Util,null,[{key:"isString",value:function(e){return"string"==typeof e}},{key:"toArray",value:function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}},{key:"isForIn",value:function(e){return/^\w* _in_ \w*$/.test(e)}},{key:"isForForIn",value:function(e){return/^\w* _in*$/.test(e)}},{key:"isForOrForFor",value:function(e){return/^\w* _in_ \w|_in*$/.test(e)}},{key:"isIgnoreChildren",value:function(e){return e.props&&e.props.hasOwnProperty("ignore")}},{key:"isNumber",value:function(e){if(null==e||""===e)return!1;if("string"==typeof e){return!!(/^\d+$/.test(e)||/^-\d+$/.test(e)||/^[1-9]\d*[.]\d+$/.test(e)||/^0[.]\d+$/.test(e)||/^-[1-9]\d*[.]\d+$/.test(e)||/^-0[.]\d+$/.test(e))}return"number"==typeof e}},{key:"setAttr",value:function(e,t,r){switch(t){case"style":e.style.cssText=r;break;case"value":var i=e.tagName||"";"input"===(i=i.toLowerCase())||"textarea"===i?e.value=r:e.setAttribute(t,r);break;default:e.setAttribute(t,r)}}},{key:"isPlaceHolder",value:function(e){return!!e&&!!/^%#\w*.\w*#%$/.test(e)}},{key:"isDotOperatorExpression",value:function(e){return/^\w*\.\w*$/.test(e)}},{key:"getPlaceHolderValue",value:function(e){return e.slice(2,-2)}},{key:"isOperatorExpression",value:function(e){return!!Util.isString(e)&&!!/^\{\w*|\|\%+\}$/.test(e)}},{key:"getOperatorExpression",value:function getOperatorExpression(content,data,dataKey){if(Util.isString(content)){var expression=content.slice(content.indexOf("{")+1,content.indexOf("}")),startIndex=expression.indexOf("%#"),endIndex=expression.indexOf("#%")+2;if(-1!=startIndex&&-1!=endIndex&&startIndex<endIndex){var placeHolder=expression.slice(startIndex,endIndex),realValue=void 0;if(placeHolder.indexOf(".")>0){if(Util.getPlaceHolderValue(placeHolder).split(".")[0]===dataKey){var placeHolderValue=data[Util.getPlaceHolderValue(placeHolder).split(".")[1]];realValue=Util.isNumber(placeHolderValue)?placeHolderValue:'"'+placeHolderValue+'"'}}else realValue=data[Util.getPlaceHolderValue(placeHolder)];expression=expression.replace(placeHolder,realValue)}return eval(expression)}}}]),Util}(),DiffList=function(){function e(t,r){_classCallCheck(this,e);var i=this.makeKeyIndex(t).keyIndex,n=this.makeKeyIndex(r).keyIndex;this.moveOperator=[],this.childList=[];for(var a=0;a<t.length;a++){var l=t[a],s=this.getKey(l);n.hasOwnProperty(s)?this.childList.push(r[n[s]]):this.childList.push(null)}this.tempList=this.childList.slice(0);for(var o=0;o<this.tempList.length;)null===this.tempList[o]?(this.remove(o),this.removeCopyTempList(o)):o++;for(var u=0,c=0;c<r.length;c++){var d=r[c],h=this.getKey(d),p=this.tempList[u],f=this.getKey(p);if(p)if(h!=f)if(i.hasOwnProperty(h))h===getKey(this.tempList[u+1])?(this.remove(c),this.removeCopyTempList(u),u++):this.insert(c,d);else this.insert(c,d);else u++;else this.insert(c,d)}for(var v=this.tempList.length-u;u++<this.tempList.length;)v--,this.remove(v+r.length)}return _createClass(e,[{key:"makeKeyIndex",value:function(e){for(var t={},r=0;r<e.length;r++){var i=e[r];t[this.getKey(i)]=r}return{keyIndex:t}}},{key:"getKey",value:function(e){if(e)return e.key}},{key:"removeCopyTempList",value:function(e){this.tempList.splice(e,1)}},{key:"remove",value:function(e){this.moveOperator.push({index:e,type:0})}},{key:"insert",value:function(e,t){this.moveOperator.push({index:e,item:t,type:1})}},{key:"getResult",value:function(){return{moves:this.moveOperator,child:this.childList}}}]),e}();function observe(e,t,r){return Object.keys(e).forEach(function(i){var n=e[i],a=new Observable;t.put(i,a),Object.defineProperty(e,i,{get:function(){return a.add(r),n},set:function(e){var t=n!==e;n=e,t&&a.invoke()}})}),e}function Observable(){this.updateFunctions=new Set}function clone(e){var t=function(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1)},r=void 0,i=t(e);if("Object"===i)r={};else{if("Array"!==i)return e;r=[]}for(key in e){var n=e[key];"Object"==t(n)?r[key]=arguments.callee(n):"Array"==t(n)?r[key]=arguments.callee(n):r[key]=e[key]}return r}function h(e,t,r){return new Element(e,t,r)}function diff(e,t){return new Diff(e,t).patches}function patch(e,t){return new Patch(e,t)}Observable.prototype.add=function(e){this.updateFunctions.add(e)},Observable.prototype.invoke=function(){this.updateFunctions.forEach(function(e){return e()})};var Map=function(){function e(){_classCallCheck(this,e),this.length=0,this.map=new Object}return _createClass(e,[{key:"put",value:function(e,t){e in this.map||this.length++,this.map[e]=t}},{key:"get",value:function(e){return e in this.map?this.map[e]:null}},{key:"remove",value:function(e){e in this.map&&(delete this.map[e],this.length--)}},{key:"size",value:function(){return this.length}},{key:"clear",value:function(){length=0,this.map=new Object}}]),e}(),RV=function(){function e(t){var r=this;_classCallCheck(this,e);var i=t.el,n=t.data,a=t.dom,l=Util.isString(i)?document.querySelector(i):i;this.data=n,this.ve=this.getVirtualElement(this.applyTruthfulData(a)),this.w=this.ve.render(),l.appendChild(this.w),this.observeMap=new Map,observe(this.data,this.observeMap,function(){r.updatedom(a)}),this.updatedom(a)}return _createClass(e,[{key:"updatedom",value:function(e){var t=this.getVirtualElement(this.applyTruthfulData(e));window.nve=t,window.ve=this.ve,patch(this.w,diff(this.ve,t)),this.ve=t}},{key:"watch",value:function(e,t){this.observeMap.get(e).add(t)}},{key:"getVirtualElement",value:function(e){var t=this,r=[];for(var i in e.children){var n=e.children[i];if(n instanceof Array)n.forEach(function(e){var i=t.getVirtualElement(e);r.push(i)});else if(n instanceof Object){var a=this.getVirtualElement(n);r.push(a)}else r.push(n)}return h(e.tag,e.props,r)}},{key:"applyTruthfulData",value:function(e){var t=this;if("for"in e.props){var r=[],i=void 0;if(!Util.isForIn)throw new Error("the for directive use error");"childDomDatakey"in e?(r=e.data,i=e.childDomDatakey):"domDataKey"in e?(e.props.for.split(" _in_ ")[1]===e.domDataKey&&(r=e.data),i=e.props.for.split(" _in_ ")[0]):(r=this.data[e.props.for.split(" _in_ ")[1]],i=e.props.for.split(" _in_ ")[0]);var n=[];return r.forEach(function(r){var a=t.vdom2rdom(e,r,i,r);n.push(a)}),n}var a=void 0,l=void 0;return"data"in e?(a=e.data,l=e.childDomDatakey):(a=this.data,l=void 0),this.vdom2rdom(e,a,l,this.data)}},{key:"vdom2rdom",value:function(e,t,r,i){var n={};n.tag=e.tag,n.children=[],n.props={};var a=Object.keys(e.props);for(var l in a){var s=a[l];if("style"===s){var o=e.props[s];if(o.indexOf(",")>-1){var u=o.split(",");n.props[s]=this.handleArrayStyle(t,u,r)}else n.props[s]=this.handleSingleStyle(t,o,r)}else Util.isPlaceHolder(e.props[s])?Util.isDotOperatorExpression(Util.getPlaceHolderValue(e.props[s]))?n.props[s]=t[Util.getPlaceHolderValue(e.props[s]).split(".")[1]]:n.props[s]=i[Util.getPlaceHolderValue(e.props[s])]:Util.isOperatorExpression(e.props[s])?n.props[s]=Util.getOperatorExpression(e.props[s],t,r):n.props[s]=e.props[s]}for(var c in e.children)Util.isString(e.children[c])?Util.isPlaceHolder(e.children[c])?-1==Util.getPlaceHolderValue(e.children[c]).indexOf(r)?n.children[c]=i[Util.getPlaceHolderValue(e.children[c])]:n.children[c]=t[Util.getPlaceHolderValue(e.children[c]).split(".")[1]]:n.children[c]=e.children[c]:(e.children[c]instanceof Object&&("childDomData"in e.props?(e.children[c].childDomDatakey=e.props.childDomData,e.children[c].data=t):"domData"in e.props&&(e.children[c].domDataKey=e.props.domData,e.children[c].data=t[c]),e.children[c].data=t),n.children[c]=this.applyTruthfulData(e.children[c]));return n}},{key:"handleSingleStyle",value:function(e,t,r){var i="";if(r)if(Util.isPlaceHolder(t))if(-1!=Util.getPlaceHolderValue(t).indexOf(r)){i=e[Util.getPlaceHolderValue(t).split(".")[1]]}else{var n=t.split(":")[0],a=t.split(":")[1];i=n+":"+(a=e[Util.getPlaceHolderValue(a)])}else i=t;else{var l=t.split(":")[0],s=t.split(":")[1];i=Util.isPlaceHolder(s)?l+":"+(s=e[Util.getPlaceHolderValue(s)]):t}return i}},{key:"handleArrayStyle",value:function(e,t,r){var i="",n=!0,a=!1,l=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;i+=this.handleSingleStyle(e,u,r)+";"}}catch(e){a=!0,l=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw l}}return i}}]),e}();exports.default=RV}]);